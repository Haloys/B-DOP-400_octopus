- name: Update apt cache
  apt:
    update_cache: yes
    cache_valid_time: 3600

- name: Install Node.js and npm
  apt:
    name:
      - nodejs
      - npm
    state: present
    update_cache: no

- name: Create directory for result app
  file:
    path: /opt/result-app
    state: directory
    mode: '0755'

- name: Extract result application
  unarchive:
    src: "{{ playbook_dir }}/result.tar"
    dest: /opt/result-app
    mode: '0755'
    remote_src: no

- name: Install Node.js dependencies
  npm:
    path: /opt/result-app
    state: present

- name: Create systemd service file for result app
  template:
    src: files/result.service
    dest: /etc/systemd/system/result.service
    mode: '0644'

- name: Reload systemd daemon
  systemd:
    daemon_reload: yes

- name: Ensure result service is enabled and started
  systemd:
    name: result
    enabled: yes
    state: started